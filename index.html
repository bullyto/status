<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ap√©ro Status Admin</title>

  <meta name="theme-color" content="#0a121c" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="icon-192.png" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <link rel="stylesheet" href="./styles.css" />

  <style>
    /* On garde TOUT pour que app.js fonctionne, mais on masque l‚Äôaffichage */
    .ui-hide { display:none !important; }

    /* Cache les boutons pr√©-programm√©s */
    #btnServiceOK,
    #btnPreviewPopup,
    #btnDownload { display:none !important; }

    /* Cache toute la zone GitHub (inputs toujours pr√©sents) */
    .gh-zone { display:none !important; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <img src="icon-192.png" alt="Logo" />
        <div>
          <h1>Ap√©ro Status Admin</h1>
          <div class="small">
            Pilote <code class="inline">status.json</code> (panne, incident, m√©t√©o, s√©curit√©)
            et publie directement sur APERO DE NUIT 66¬Æ et APERO CATALAN¬Æ.
          </div>
        </div>
      </div>

      <div class="badge">
        <span>√âtat :</span> <b id="pActive">‚Äî</b>
        <span style="opacity:.5">‚Ä¢</span>
        <span>Mode :</span> <b id="pMode">‚Äî</b>
      </div>
    </div>

    <div class="grid">
      <section class="card">
        <div class="hd"><div class="small">Contr√¥le</div></div>
        <div class="bd">

          <div class="row">
            <div>
              <label>Statut global</label>
              <select id="active">
                <option value="false">Inactif (aucun pop-up)</option>
                <option value="true">Actif (pop-up affich√©)</option>
              </select>
            </div>
            <div>
              <label>Situation</label>
              <select id="mode"></select>
            </div>
          </div>

          <div class="hr"></div>

          <div class="row">
            <div>
              <label>Titre</label>
              <input id="title" placeholder="Ex: Service temporairement suspendu" />
            </div>
            <div>
              <label>Niveau</label>
              <select id="severity">
                <option value="info">info</option>
                <option value="warning">warning</option>
                <option value="danger">danger</option>
              </select>
            </div>
          </div>

          <div style="margin-top:10px">
            <label>Message</label>
            <textarea id="message" placeholder="Texte affich√© dans le pop-up..."></textarea>
          </div>

          <div style="margin-top:10px">
            <label>Image (chemin local dans le d√©p√¥t status)</label>
            <input id="image" placeholder="images/panne.png" />
          </div>

          <div class="hr"></div>

          <!-- Boutons techniques (pr√©sents mais cach√©s) -->
          <div class="btns">
            <button class="ok" id="btnServiceOK">Pr√©parer ‚Äúservice OK‚Äù</button>
            <button class="secondary" id="btnPreviewPopup">Pr√©visualiser le pop-up</button>
            <button id="btnDownload">T√©l√©charger status.json</button>
          </div>

          <div class="hr"></div>

          <!-- Zone GitHub (pr√©sente mais cach√©e, app.js OK) -->
          <div class="gh-zone">
            <div class="row">
              <div>
                <label>D√©p√¥t GitHub</label>
                <div style="display:flex;gap:10px">
                  <input id="ghOwner" placeholder="bullyto" />
                  <input id="ghRepo" placeholder="status" />
                </div>
              </div>
              <div>
                <label>Branch</label>
                <input id="ghBranch" placeholder="main" />
              </div>
            </div>

            <div style="margin-top:10px">
              <label>Chemin du fichier</label>
              <input id="ghPath" placeholder="status.json" />
            </div>

            <div style="margin-top:10px">
              <label>Token GitHub</label>
              <input id="ghToken" type="password" autocomplete="off" />
            </div>

            <div class="btns" style="margin-top:12px">
              <button class="secondary" id="btnSaveToken">Enregistrer le token</button>
              <button class="danger" id="btnClearToken">Supprimer le token</button>
            </div>
          </div>

          <!-- Seul bouton visible -->
          <div class="btns" style="margin-top:12px">
            <button id="btnPublish">Publier</button>
          </div>

        </div>
      </section>

      <!-- Aper√ßu -->
      <section class="card preview">
        <div class="hd"><div class="small">Aper√ßu</div></div>
        <div class="bd">
          <img id="pImg" alt="Aper√ßu image" src="./images/panne.png" />
          <div class="badge">
            <span>Derni√®re maj :</span> <b id="pUpdated">‚Äî</b>
            <span style="opacity:.5">‚Ä¢</span>
            <span>Severity :</span> <b id="pSev">‚Äî</b>
          </div>
          <div id="pTitle" style="margin-top:10px;font-weight:900;font-size:18px">‚Äî</div>
          <div id="pMsg" style="margin-top:6px;opacity:.85">‚Äî</div>
        </div>
      </section>
    </div>
  </div>

  <!-- Preview overlay -->
  <div id="overlay" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.65); z-index:999999; align-items:center; justify-content:center; padding:16px;">
    <div style="max-width:520px; width:100%; background:#111; border:1px solid rgba(255,255,255,.12); border-radius:16px; overflow:hidden;">
      <img id="overlayImg" alt="" style="width:100%; display:block;">
      <div style="padding:14px 14px 16px;">
        <div id="overlayTitle" style="font-size:18px; font-weight:800; margin-bottom:6px;"></div>
        <div id="overlayMsg" style="font-size:14px; line-height:1.35;"></div>
        <button id="overlayBtn" style="margin-top:12px; width:100%;">OK</button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <!-- üîí INJECTION TOKEN (TEST) : base64 morcel√© ‚Üí #ghToken + localStorage -->
  <script>
  (function(){
    const parts = [
      "COLLE_B64_PART_1",
      "COLLE_B64_PART_2",
      "COLLE_B64_PART_3"
    ];
    try {
      const token = atob(parts.join(""));
      const input = document.getElementById("ghToken");
      if (input) input.value = token;
      localStorage.setItem("gh_token", token);
    } catch(e){
      console.error("Token decode failed", e);
    }
  })();
  </script>

  <script src="./app.js"></script>

  <script>
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js");
    });
  }
  </script>
</body>
</html>
